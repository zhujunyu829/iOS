<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455786)"/><meta name="altitude" content="84"/><meta name="author" content="171959017@qq.com"/><meta name="created" content="2017-05-27 02:13:15 +0000"/><meta name="latitude" content="28.23074245999999"/><meta name="longitude" content="112.87553307"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-05-27 02:21:35 +0000"/><title>GCD信号量</title></head><body>
<div><a href="http://blog.csdn.net/Cloudox_/article/details/71107179">http://blog.csdn.net/Cloudox_/article/details/71107179</a></div>
<div><br/></div>
<div>
<div style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 15px; vertical-align: baseline; background-color: transparent; color: rgb(102, 102, 102); font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">
<div>信号量是一个整数，在创建的时候会有一个初始值，这个初始值往往代表我要控制的同时操作的并发数。在操作中，对信号量会有两种操作：信号通知与等待。信号通知时，信号量会+1，等待时，如果信号量大于0，则会将信号量-1，否则，会等待直到信号量大于0。什么时候会大于零呢？往往是在之前某个操作结束后，我们发出信号通知，让信号量+1。</div>
</div>
<p style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 15px; vertical-align: baseline; background-color: transparent; color: rgb(102, 102, 102); font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">说完概念，我们来看看GCD中的三个信号量操作：</p>
<ul style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; list-style: square inside; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(153, 153, 153); font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">
<li>dispatch_semaphore_create：创建一个信号量（semaphore）dispatch_semaphore_signal：信号通知，即让信号量+1dispatch_semaphore_wait：等待，直到信号量大于0时，即可操作，同时将信号量-1</li>
</ul>
<p style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 15px; vertical-align: baseline; background-color: transparent; color: rgb(102, 102, 102); font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">在使用的时候，往往会创建一个信号量，然后进行多个操作，每次操作都等待信号量大于0再操作，同时信号昂-1，操作完后将信号量+1，类似下面这个过程：</p>
<div style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: 14px; padding: 5px 5px 5px 60px; color: rgb(51, 51, 51); background-color: rgba(128, 128, 128, 0.0470588); border: 1px solid rgba(128, 128, 128, 0.0745098); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-weight: normal; outline: rgb(0, 0, 0); vertical-align: baseline; overflow-y: hidden; overflow-x: auto; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-position: initial initial; background-repeat: initial initial;">dispatch_semaphore_t sema = dispatch_semaphore_create(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">5</span>);<br/>
<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">for</span> (<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">100</span>次循环操作） {<br/>
    dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);<br/>
    <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(102, 0, 102); background-position: initial initial; background-repeat: initial initial;">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">0</span>), ^{<br/>
        <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 操作</span><br/>
        dispatch_semaphore_signal(sema);<br/>
    });<br/>
}</code></div>
<div><br/></div>
</div>
<div>
<div style="box-sizing: border-box; padding: 0px; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';">上面代码表示我要操作100次，但是控制允许同时并发的操作最多只有5次，当并发量达到5后，信号量就减小到0了，这时候wait操作会起作用，DISPATCH_TIME_FOREVER表示会永远等待，一直等到信号量大于0，也就是有操作完成了，将信号量+1了，这时候才可以结束等待，进行操作，并且将信号量-1，这样新的任务又要等待。</span></span></span></div>
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';"><br/></span></span></span></div>
<div><br/></div>
<div>
<div style="box-sizing: border-box; font-weight: 100; padding: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 28px;"><span style="font-family: 'Microsoft YaHei';">多个请求结束后统一操作</span></span></span></div>
<div>
<p style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 15px; vertical-align: baseline; background-color: transparent; color: rgb(102, 102, 102); font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">这个需求我们一般可以用GCD的group和notify来做到：</p>
<div style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: 14px; padding: 5px 5px 5px 60px; color: rgb(51, 51, 51); background-color: rgba(128, 128, 128, 0.0470588); border: 1px solid rgba(128, 128, 128, 0.0745098); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-weight: normal; outline: rgb(0, 0, 0); vertical-align: baseline; overflow-y: hidden; overflow-x: auto; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-position: initial initial; background-repeat: initial initial;">    dispatch_group_t <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">group</span> = dispatch_group_create();<br/>
    dispatch_group_async(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">group</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">0</span>), ^{<br/>
        <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">//请求1</span><br/>
        NSLog(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 136, 0); background-position: initial initial; background-repeat: initial initial;">@"Request_1"</span>);<br/>
    });<br/>
    dispatch_group_async(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">group</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">0</span>), ^{<br/>
        <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">//请求2</span><br/>
        NSLog(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 136, 0); background-position: initial initial; background-repeat: initial initial;">@"Request_2"</span>);<br/>
    });<br/>
    dispatch_group_async(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">group</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;">0</span>), ^{<br/>
        <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">//请求3</span><br/>
        NSLog(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 136, 0); background-position: initial initial; background-repeat: initial initial;">@"Request_3"</span>);<br/>
    });<br/>
    dispatch_group_notify(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">group</span>, dispatch_get_main_queue(), ^{<br/>
        <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">//界面刷新</span><br/>
        NSLog(<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 136, 0); background-position: initial initial; background-repeat: initial initial;">@"任务均完成，刷新界面"</span>);<br/>
    });</code></div>
<div><br/></div>
</div>
<div>
<div style="box-sizing: border-box; padding: 0px; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';">notify的作用就是在group中的其他操作全部完成后，再操作自己的内容，所以我们会看到上面三个内容都打印出来后，才打印界面刷新的内容。</span></span></span></div>
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';"><br/></span></span></span></div>
<div>
<div style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: 14px; padding: 5px 5px 5px 60px; color: rgb(51, 51, 51); background-color: rgba(128, 128, 128, 0.0470588); border: 1px solid rgba(128, 128, 128, 0.0745098); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-weight: normal; outline: rgb(0, 0, 0); vertical-align: baseline; overflow-y: hidden; overflow-x: auto; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-position: initial initial; background-repeat: initial initial;"><span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"><br/>
dispatch_semaphore_t sema </span>=<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 136, 0); background-position: initial initial; background-repeat: initial initial;"> dispatch_semaphore_create(0);<br/>
[网络请求:{<br/>
        成功：dispatch_semaphore_signal(sema);<br/>
        失败：dispatch_semaphore_signal(sema);<br/>
}];<br/>
dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);</span></code></div>
</div>
<div><br/></div>
<div>
<div style="box-sizing: border-box; padding: 0px; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';"><br/></span></span></span></div>
<div>
<h1 style="box-sizing: border-box; font-size: 28px; font-family: 'Microsoft YaHei'; font-weight: 100; color: rgb(102, 102, 102); padding: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">多个请求顺序执行</h1>
</div>
<div><br/></div>
<div><span style="color: rgb(102, 102, 102);"><span style="font-size: 15px;"><span style="font-family: 'Microsoft YaHei';">线程依赖用GCD做比较麻烦，建议用NSOperationQueue做，可以更加方便的设置任务之间的依赖。</span></span></span></div>
</div>
<div style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: 14px; padding: 5px 5px 5px 60px; color: rgb(51, 51, 51); background-color: rgba(128, 128, 128, 0.0470588); border: 1px solid rgba(128, 128, 128, 0.0745098); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-weight: normal; outline: rgb(0, 0, 0); vertical-align: baseline; overflow-y: hidden; overflow-x: auto; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border: 0px; outline: rgb(0, 0, 0); vertical-align: baseline; background-position: initial initial; background-repeat: initial initial;">    <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 1.任务一：获取用户信息</span><br/>
    NSBlockOperation *operation1 = [NSBlockOperation blockOperationWithBlock:^{<br/>
        [<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">self</span> request_A];<br/>
    }];<br/>
<br/>
    <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 2.任务二：请求相关数据</span><br/>
    NSBlockOperation *operation2 = [NSBlockOperation blockOperationWithBlock:^{<br/>
        [<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 0, 136); background-position: initial initial; background-repeat: initial initial;">self</span> request_B];<br/>
    }];<br/>
<br/>
    <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 3.设置依赖</span><br/>
    [operation2 addDependency:operation1];<span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 任务二依赖任务一</span><br/>
<br/>
    <span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(136, 0, 0); background-position: initial initial; background-repeat: initial initial;">// 4.创建队列并加入任务</span><br/>
    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</code>
<div><span style="color: inherit;"><span style="background-color: transparent;"><span style="font-size: inherit;">    [queue addOperations:@[operation2, operation1] waitUntilFinished:</span></span></span><span style="box-sizing: border-box; padding: 0px; font-family: 'Microsoft YaHei'; font-weight: normal; border: 0px; outline: rgb(0, 0, 0); font-size: 14px; vertical-align: baseline; background-color: transparent; color: rgb(0, 102, 102); background-position: initial initial; background-repeat: initial initial;"><span style="background-color: transparent;">NO</span></span><span style="color: inherit;"><span style="background-color: transparent;"><span style="font-size: inherit;">];</span></span></span></div>
</div>
</div>
<div><br/></div>
<div><br/></div>
</div>
</div>
</div>
</div>
</div>
</div>
</body></html>